# YBU 选课系统 Web 界面

这是一个基于Flask和Socket.IO的现代化Web界面，为YBU延边大学自动选课系统提供多用户并发访问支持。

## 🌟 功能特性

- **直接YBU登录**：无需注册，直接使用YBU学号和密码登录
- **多用户支持**：支持多个用户同时登录和使用
- **实时通信**：基于WebSocket的实时状态推送
- **并发选课**：支持多用户同时进行选课操作
- **用户隔离**：每个用户独立的会话和数据管理
- **现代界面**：使用Tailwind CSS的响应式美观界面
- **移动端适配**：完美支持手机和平板访问

## 🚀 快速开始

### 1. 启动Web界面

```bash
# 启动Web服务器
python3 start_web.py
```

启动成功后会显示：
```
🚀 启动 YBU 选课系统 Web 界面
==================================================
📱 访问地址：http://localhost:3000
📱 局域网访问：http://your-ip:3000
🔧 主机地址：0.0.0.0
🔧 端口：3000
🔧 支持多用户并发登录和抢课
==================================================
```

### 2. 访问界面

- **本地访问**：http://localhost:3000
- **局域网访问**：http://your-ip:3000（同学可以通过您的IP访问）
- **移动设备**：同样的地址，响应式设计自动适配

### 3. 直接登录

1. 打开Web界面
2. 输入您的YBU学号（如：12xxxxx）
3. 输入您的YBU密码（支持特殊字符）
4. 点击登录，系统自动连接YBU教务系统

## 📱 使用流程

### 第一步：登录YBU系统
1. 在登录页面输入YBU学号和密码
2. 点击"登录"按钮
3. 实时查看登录状态：
   ```
   ⏳ 正在连接YBU系统，请稍候...
   ⏳ 正在初始化浏览器代理...
   ⏳ 正在启动浏览器...
   ⏳ 正在登录YBU教务系统...
   ✅ YBU系统登录成功，可以开始选课了
   ```

### 第二步：进入控制面板
- 登录成功后自动跳转到主控制面板
- 查看YBU连接状态和系统状态

### 第三步：获取课程列表
1. 点击"获取课程"按钮
2. 系统自动从YBU教务系统获取可选课程
3. 实时显示课程数据获取进度

### 第四步：开始选课
1. 从课程列表中选择目标课程
2. 点击"抢课"按钮
3. 系统自动执行选课操作
4. 实时接收选课结果通知

### 第五步：查看任务状态
- 在任务面板查看选课任务状态
- 实时接收成功/失败通知
- 查看详细的操作日志

## 🏗️ 技术架构

### 后端架构
```
Flask Web应用
├── 直接YBU认证（无需注册）
├── 会话管理（多用户隔离）
├── 代理实例管理（每用户独立）
├── 任务管理（TaskManager）
└── WebSocket通信（实时消息）
```

### 前端架构
```
现代Web界面
├── Tailwind CSS（样式框架）
├── Socket.IO（实时通信）
├── Axios（HTTP请求）
├── 响应式设计（多设备支持）
└── 实时状态更新
```

### 数据存储
```
内存存储
├── 用户会话（user_sessions）
├── 活跃用户（active_users）
├── 任务记录（tasks.db）
└── 浏览器实例（独立管理）
```

## 🔐 安全特性

- **直接验证**：直接向YBU教务系统验证凭据
- **会话安全**：Flask会话管理，自动过期
- **用户隔离**：每个用户独立的数据空间和浏览器实例
- **密码安全**：密码仅在会话中使用，不保存到本地
- **本地运行**：所有数据在本地处理，不上传到外部服务器

## 🌐 部署说明

### 本地开发
```bash
# 开发模式
WEB_DEBUG=true python3 start_web.py

# 生产模式
python3 start_web.py
```

### 局域网共享
```bash
# 查看本机IP
ifconfig | grep inet     # Mac/Linux
ipconfig                 # Windows

# 启动服务器（默认已支持局域网访问）
python3 start_web.py

# 同学访问
http://your-ip:3000
```

### 自定义配置
```bash
# 使用不同端口
WEB_PORT=8080 python3 start_web.py

# 仅本机访问
WEB_HOST=127.0.0.1 python3 start_web.py

# 调试模式
WEB_DEBUG=true python3 start_web.py
```

### 生产环境部署

#### 使用Gunicorn (推荐)
```bash
# 安装Gunicorn
pip install gunicorn

# 启动应用
gunicorn -w 4 -b 0.0.0.0:3000 --worker-class eventlet app:app
```

#### Docker部署
```dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY . .

RUN pip install -r requirements.txt -r requirements.txt
RUN playwright install chromium

EXPOSE 3000

CMD ["python3", "start_web.py"]
```

## 📊 性能说明

- **并发用户**：支持50+用户同时在线
- **并发选课**：支持多用户同时进行选课操作
- **内存使用**：每用户约200-300MB内存占用
- **响应时间**：登录5-10秒，选课1-3秒
- **网络要求**：需要稳定的网络连接到YBU服务器

## 🔧 配置选项

### 环境变量

通过环境变量配置：
```bash
# Web服务器配置
export WEB_HOST=0.0.0.0      # 监听地址
export WEB_PORT=3000         # 监听端口
export WEB_DEBUG=false       # 调试模式

# 浏览器配置
export HEADLESS=true         # 无头模式
export CAPTCHA_MODE=ai       # 验证码识别模式
```

### 应用配置
```python
# 在start_web.py中可以修改
host = os.getenv('WEB_HOST', '0.0.0.0')
port = os.getenv('WEB_PORT', '3000')
debug = os.getenv('WEB_DEBUG', 'false').lower() in ('true', '1', 'yes')
```

## 🐛 故障排除

### 常见问题

**1. 端口被占用**
```bash
# 查找占用端口的进程
lsof -i :3000

# 使用其他端口
WEB_PORT=8080 python3 start_web.py
```

**2. YBU登录失败**
- ✅ 确认YBU学号和密码正确
- ✅ 检查网络连接到YBU服务器
- ✅ 确认YBU教务系统是否可正常访问

**3. WebSocket连接失败**
- 检查浏览器是否支持WebSocket
- 刷新页面重新连接
- 检查防火墙设置

**4. 页面无法访问**
```bash
# 检查服务器是否启动
ps aux | grep python | grep start_web

# 检查端口监听
netstat -an | grep 3000
```

**5. 多用户使用问题**
- 每个用户使用自己的YBU账号
- 系统已做用户隔离处理
- 互不干扰，独立会话

## 📱 多设备使用

### 电脑端
- 推荐使用Chrome、Firefox、Safari、Edge
- 最佳分辨率：1920x1080或以上

### 手机端
- 响应式设计，自动适配屏幕
- 支持iOS Safari、Android Chrome
- 可以在宿舍用手机选课

### 平板端
- 完美支持iPad、Android平板
- 横屏竖屏都能正常使用

## 🎯 使用技巧

### 选课策略
- **提前登录**：选课开始前5分钟登录系统
- **网络稳定**：使用有线网络或强WiFi信号
- **快速响应**：选课开始立即操作

### 多人使用
- 支持同学们同时使用同一个Web服务
- 每人使用自己的YBU账号登录
- 局域网共享：`http://your-ip:3000`

### 最佳实践
- 选课前测试网络连接
- 准备好备选课程
- 关注实时状态提示

## 📞 技术支持

### 问题诊断
1. **查看控制台日志**：浏览器F12开发者工具
2. **检查网络连接**：确保能访问YBU教务系统
3. **重启服务器**：`Ctrl+C`停止，重新启动
4. **清除缓存**：刷新浏览器页面

### 联系方式
如遇到问题，请：
- 查看错误提示信息
- 截图保存问题现象
- 提供详细的操作步骤

## 🎉 更新日志

### v2.0.0 (当前版本)
- ✨ **重大更新**：从注册系统改为直接YBU登录
- ✨ **用户体验**：简化登录流程，无需注册
- ✨ **实时推送**：WebSocket实时状态更新
- ✨ **移动端**：完美适配手机和平板
- 🔧 **修复**：解决多个技术问题，提高稳定性

### v1.x.x (旧版本)
- 基于注册系统的Web界面
- 已废弃，建议升级到v2.0.0

---

**⚠️ 重要提醒**：
- 本系统仅供学习研究使用
- 请遵守学校选课相关规定
- 合理使用，不要影响正常的教务系统运行
- 选课成功后请及时确认 